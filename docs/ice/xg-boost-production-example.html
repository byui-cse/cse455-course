<!DOCTYPE html>
<html>
<head>
	<title>XGBoost to Docker</title>
    <style>
        @font-face {
            font-family: 'icomoon';
            src: url('https://byui-cse.github.io/cse455-course/shared/fonts/byui/icomoon.eot');
            src: url('https://byui-cse.github.io/cse455-course/shared/fonts/byui/icomoon.eot#iefix-8k8p81') format('embedded-opentype'), url('https://byui-cse.github.io/cse455-course/shared/fonts/byui/icomoon.ttf') format('truetype'), url('https://byui-cse.github.io/cse455-course/shared/fonts/byui/icomoon.woff') format('woff'), url('https://byui-cse.github.io/cse455-course/shared/fonts/byui/icomoon.svg#icomoon') format('svg');
            font-weight: normal;
            font-style: normal;
        }
    </style>
    <link rel="stylesheet" type="text/css" href="https://byui-cse.github.io/cse455-course/shared/reset.css">
    <link rel="stylesheet" type="text/css" href="https://byui-cse.github.io/cse455-course/shared/fonts/fontawesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="https://byui-cse.github.io/cse455-course/shared/lib/katex/katex.min.css">
    <link rel="stylesheet" type="text/css" href="https://byui-cse.github.io/cse455-course/shared/lib/highlight/styles/monokai-sublime.min.css">
	<link rel="stylesheet" type="text/css" href="https://byui-cse.github.io/cse455-course/shared/main.css?v1.4">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">    
    <meta charset="utf-8">

</head>
<body class="index-page">
     <div id="modal-screen">
        <div id="contents-wrapper">
            <div class="toc">
<ul>
<li><a href="#xgboost-to-docker">XGBoost to Docker</a><ul>
<li><a href="#review-the-notebook">Review the Notebook</a></li>
<li><a href="#prepare-things-for-containerization">Prepare things for containerization</a></li>
</ul>
</li>
</ul>
</div>

            <a href="#" id="hide-contents" title="Close Table of Contents"><i class="far fa-window-close"></i></a>
        </div>
    </div>
	<header>
        <span class="icon-byui-logo"></span>
        <div id="titles">
            <h1>CSE 455 - Developing AI Systems</h1>
            <h2>XGBoost to Docker</h2>
            <nav><a href="https://byui-cse.github.io/cse455-course"><i class="fas fa-home"></i></a><a href="https://byui-cse.github.io/cse455-course/module-01/">Module 1</a><a href="https://byui-cse.github.io/cse455-course/module-02/">Module 2</a><a href="https://byui-cse.github.io/cse455-course/module-03/">Module 3 - 6</a></nav>
        </div>
        <a href="#" id="show-contents" title="Show Table of Contents"><i class="far fa-list-alt"></i></a>
    </header>
	<article>
		<p><img alt="Monolithic App" src="https://byui-cse.github.io/cse455-course/shared/img/xgb_production.png" />
<em><a href="https://chatgpt.com">Photo by ChatGPT</a></em></p>
<h2 id="xgboost-to-docker">XGBoost to Docker</h2>
<p>Open this example in Colab</p>
<p><a href="https://colab.research.google.com/github/byui-cse/cse455-course/blob/main/docs/course/notebooks/XGBRegressor_example.ipynb" target="_blank"><img alt="Open In Colab" src="https://colab.research.google.com/assets/colab-badge.svg" /></a></p>
<h3 id="review-the-notebook">Review the Notebook</h3>
<p>You may have similar notebooks that you have previously built. This example demonstrates a straightforward workflow to prepare an XGBoost model for deployment within a Docker container.</p>
<p>First, we define a <strong>preprocessing function</strong> that performs all necessary data transformations. Centralizing preprocessing in a single function ensures consistency and maintainability, allowing us to apply the same transformations during both training and inference. It is essential to replicate all the transformations applied in the original notebook to maintain model accuracy and integrity.</p>
<p>Next, we <strong>persist the trained model</strong> using <strong><code>joblib</code></strong>, a Python library optimized for serializing and deserializing large NumPy arrays and machine learning models efficiently. <code>joblib</code> enables us to save the model to disk and later load it back into memory for inference without retraining.</p>
<p>Additionally, we save the <strong>feature names</strong> into a JSON file. This ensures that during deployment, the input data aligns exactly with the features expected by the model, preventing mismatches or errors when feeding new data for prediction.</p>
<p>By following these steps—centralized preprocessing, saving the model with <code>joblib</code>, and storing feature metadata—we create a robust and reproducible workflow that simplifies deploying machine learning models in Dockerized production environments.</p>
<p>Python’s <strong><code>pickle</code></strong> module is commonly used to serialize and save Python objects, including machine learning models. <strong><code>joblib</code></strong> serves a similar purpose but is optimized for objects that contain large NumPy arrays, making it faster and more memory-efficient for most machine learning models. In practice, both <code>pickle</code> and <code>joblib</code> allow you to save and load models for later use, but <code>joblib</code> is generally preferred for models with large numerical data, while <code>pickle</code> works for general-purpose Python objects.</p>
<p>Run the notebook and it will produce a couple of artifacts that we will need to download:</p>
<ul>
<li>feature_names.json</li>
<li>xgb_model.joblib</li>
</ul>
<h3 id="prepare-things-for-containerization">Prepare things for containerization</h3>
<p>Start up Docker Desktop.</p>
<p>Next we will create the following folders and files.</p>
<p><img alt="Basic Folder Structure" src="https://byui-cse.github.io/cse455-course/shared/img/docker_folders.jpg" /></p>
<p>Copy the two files into the v1 folder inside of models. Then rename xgb_model.joblib to model.joblib</p>
<p>Copy the following into the <code>Dockerfile</code> (notice that this file doesn't have an extension)</p>
<div class="codehilite"><pre><span></span><code><span class="n">FROM</span><span class="w"> </span><span class="n">python</span><span class="p">:</span><span class="mf">3.11</span><span class="o">-</span><span class="n">slim</span>
<span class="n">WORKDIR</span><span class="w"> </span><span class="o">/</span><span class="n">app</span>

<span class="c1"># Install system deps for xgboost if needed (kept minimal)</span>
<span class="n">RUN</span><span class="w"> </span><span class="n">apt</span><span class="o">-</span><span class="n">get</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">apt</span><span class="o">-</span><span class="n">get</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="o">-</span><span class="n">y</span><span class="w"> </span><span class="n">build</span><span class="o">-</span><span class="n">essential</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">rm</span><span class="w"> </span><span class="o">-</span><span class="n">rf</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">apt</span><span class="o">/</span><span class="n">lists</span><span class="o">/*</span>

<span class="n">COPY</span><span class="w"> </span><span class="n">requirements</span><span class="o">.</span><span class="n">txt</span><span class="w"> </span><span class="o">./</span>
<span class="n">RUN</span><span class="w"> </span><span class="n">pip</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">cache</span><span class="o">-</span><span class="n">dir</span><span class="w"> </span><span class="o">-</span><span class="n">r</span><span class="w"> </span><span class="n">requirements</span><span class="o">.</span><span class="n">txt</span>

<span class="c1"># Copy application files and model artifacts (ensure these exist in build context)</span>
<span class="n">COPY</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="o">/</span><span class="n">app</span>

<span class="n">EXPOSE</span><span class="w"> </span><span class="mi">5000</span>
<span class="c1"># Use gunicorn for production; fallback to Flask dev server if not installed</span>
<span class="n">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;gunicorn&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-w&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;4&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;0.0.0.0:5000&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;app.app:app&quot;</span><span class="p">]</span>
</code></pre></div>

<p>Copy this into the <code>requirements.txt</code> file:</p>
<div class="codehilite"><pre><span></span><code>flask
gunicorn
pandas
xgboost
scikit-learn==1.5.2
joblib
</code></pre></div>

<p>Run this command to build the container</p>
<div class="admonition warning">
<p class="admonition-title">Docker Must Be Running</p>
<p>If you get an error, you may have forgotten to start Docker!</p>
<p>Make sure you have Docker Desktop running.</p>
</div>
<div class="codehilite"><pre><span></span><code>docker build -t xgb-flask .
</code></pre></div>

<p>Then let's run it locally</p>
<div class="codehilite"><pre><span></span><code>docker run -p 5000:5000 xgb-flask 
</code></pre></div>

<p>You can test your code from <code>git bash</code> or the <code>terminal</code></p>
<div class="codehilite"><pre><span></span><code>curl -X POST http://localhost:5000/predict -H &quot;Content-Type: application/json&quot; -d &#39;{&quot;cylinders&quot;:8,&quot;displacement&quot;:307,&quot;acceleration&quot;:12,&quot;weight&quot;:3504,&quot;horsepower&quot;:130,&quot;year&quot;:75,&quot;origin&quot;:5,&quot;name&quot;:&quot;chevy ltd&quot;}&#39;
</code></pre></div>
	</article>
	<script src="https://byui-cse.github.io/cse455-course/shared/lib/highlight/highlight.pack.js"></script>
	<script src="https://byui-cse.github.io/cse455-course/shared/lib/katex/katex.min.js"></script>
    <script src="https://byui-cse.github.io/cse455-course/shared/lib/katex/contrib/auto-render.min.js"></script>
	<script src="https://byui-cse.github.io/cse455-course/shared/lib/smartquotes/smartquotes.min.js"></script>
    <script src="https://byui-cse.github.io/cse455-course/shared/lib/copy/copy.js"></script>
    <script>

        /* Startup scripts for katex rendering */
    	renderMathInElement(document.body,
		{
			delimiters: [
				{left: "$$", right: "$$", display: true},
				{left: "$", right: "$", display: false},
			]
    	});

        /* Highlighting code */
    	hljs.initHighlightingOnLoad();
    	var elements = document.querySelectorAll('.language-text')
		for (var i = 0; i < elements.length; i++) {
  			elements[i].classList.add('hljs');
		}

        /* TOC support */
        var hideContents = function(e){
            console.log(e.target);
            if(e.target.id === 'modal-screen' || e.target.nodeName.toLowerCase() === 'i') {
                e.preventDefault();
                document.querySelector('#contents-wrapper').classList.remove('active');
                document.querySelector('#modal-screen').classList.remove('active');
            }
        }

        var showContents = function(e){
            e.preventDefault();
            document.querySelector('#contents-wrapper').classList.add('active');
            document.querySelector('#modal-screen').classList.add('active');
        }

        document.querySelector("#hide-contents").addEventListener('click', hideContents);
        document.querySelector("#modal-screen").addEventListener('click', hideContents);
        document.querySelector("#show-contents").addEventListener('click', showContents);
    	
    </script>
</body>
</html>